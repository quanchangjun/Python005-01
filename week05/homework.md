**作业一：**使用 Python+redis 实现高并发的计数器功能
**需求描述:**
在社交类网站中，经常需要对文章、视频等元素进行计数统计功能，热点文章和视频多为高并发请求，因此采用 redis 做为文章阅读、视频播放的计数器。
请实现以下函数：

```
counter()
def counter(video_id: int):
    ...
    return count_number
    
见counter.py
```

**函数说明:**

- counter 函数为统计视频播放次数的函数，每调用一次，播放次数 +1
- 参数 video_id 每个视频的 id，全局唯一
- 基于 redis 实现自增操作，确保线程安全

**期望执行结果：**
conuter(1001) # 返回 1
conuter(1001) # 返回 2
conuter(1002) # 返回 1
conuter(1001) # 返回 3
conuter(1002) # 返回 2
…

**选做:：**
可以基于 Django+ redis 实现，使用 redis 作为 Django 后端可参考如下代码：
https://django-redis-chs.readthedocs.io/zh_CN/latest/

**作业二：**在使用短信群发业务时，公司的短信接口限制接收短信的手机号，每分钟最多发送五次，请基于 Python 和 redis 实现如下的短信发送接口：
已知有如下函数：

```
def sendsms(telephone_number: int, content: string, key=None)：
    # 短信发送逻辑, 作业中可以使用 print 来代替
    pass
    # 请实现每分钟相同手机号最多发送五次功能, 超过 5 次提示调用方,1 分钟后重试稍后
    pass
    print("发送成功")
    
见sendsms.py
```

**期望执行结果：**

sendsms(12345654321, content=“hello”) # 发送成功
sendsms(12345654321, content=“hello”) # 发送成功
…
sendsms(88887777666, content=“hello”) # 发送成功
sendsms(12345654321, content=“hello”) # 1 分钟内发送次数超过 5 次, 请等待 1 分钟
sendsms(88887777666, content=“hello”) # 发送成功

**选做：**
1.content 为短信内容，超过 70 个字自动拆分成两条发送
\2. 为 sendsms() 函数增加装饰器 send_times()，通过装饰器方式实现限制手机号最多发送次数，如：

```
@send_times(times=5)
sendsms()
```

**作业三：**请用自己的语言描述如下问题：

- 在你目前的工作场景中，哪个业务适合使用 rabbitmq？ 引入 rabbitmq 主要解决什么问题?（非相关工作可以以设计淘宝购物和结账功能为例来描述）

  ~~~
  假如你想在淘宝上买一双运动鞋，那么你是不是会在搜索框中搜“XXX运动鞋”，这个时候系统将会模糊匹配的所有符合要求的运动鞋，然后展示给你。
  ~~~

  

- 如何避免消息重复投递或重复消费？

  ```
  在消息生产时，MQ 内部针对每条生产者发送的消息生成一个 inner-msg-id，作为去重的依据（消息投递失败并重传），避免重复的消息进入队列；在消息消费时，要求消息体中必须要有一个 bizId（对于同一业务全局唯一，如支付 ID、订单 ID、帖子 ID 等）作为去重的依据，避免同一条消息被重复消费。
  ```

  

- 交换机 fanout、direct、topic 有什么区别？

  ~~~
  最常用的交换机有三种：direct、topic、fanout。我分别叫他们：“直接连接交换机”，“主题路由匹配交换机”，“无路由交换机”。
  direct： 生产者/消费者 = 1：1 
  topic: 生产者/消费者 消息按类型分发
  fanout: 生产者/消费者 = 1：N 
  ~~~

  

- 架构中引入消息队列是否利大于弊？你认为消息队列有哪些缺点？

  ~~~
  优点：
  目使用消息队列的也就是：解耦、异步、削峰。
  
  缺点：
  系统可用性降低
  系统复杂性提高
  一致性问题
  
  消息队列实际是一种非常复杂的架构，你引入它有很多好处，但是也得针对它带来的坏处做各种额外的技术方案和架构来规避掉，比如系统复杂度提升了一个数量级，也许是复杂了10倍。但是关键时刻，用，还是得用的，至于如何解决以上的缺点，那就是下一步需要讨论的问题了。
  ~~~

  

**作业 3 提示：**
（1）服务间异步通信
（2）顺序消费
（3）定时任务
（4）流量削峰
（5）解耦
（6）利用消息队列将高并发访问变为串行操作
（7）异步下单
（8）消息队列持久化